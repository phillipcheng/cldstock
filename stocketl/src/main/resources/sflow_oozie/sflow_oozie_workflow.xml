<?xml version="1.0" encoding="UTF-8"?>
<workflow-app name="huawei-wf" xmlns="uri:oozie:workflow:0.5" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="uri:oozie:workflow:0.5 oozie-workflow-0.5.xsd">
	<start to="genTasks"/>
	<kill name="fail"><message>Java failed, error message[${wf:errorMessage(wf:lastErrorNode())}]</message></kill>
	<action name="genTasks">
		<map-reduce>
            <job-tracker>${jobTracker}</job-tracker>
            <name-node>${nameNode}</name-node>
            <prepare>
				<delete path="/sflow/genTasks/${wf:id()}"/>
			</prepare>
            <configuration>
                <property>
                    <name>mapred.mapper.new-api</name>
                    <value>true</value>
                </property>
                <property>
                    <name>mapred.reducer.new-api</name>
                    <value>true</value>
                </property>
                <property>
                    <name>mapreduce.job.map.class</name>
                    <value>etl.engine.InvokeMapper</value>
                </property>
                <property>
                    <name>mapreduce.job.inputformat.class</name>
                    <value>org.apache.hadoop.mapreduce.lib.input.NLineInputFormat</value>
                </property>
                <property>
                    <name>mapreduce.input.lineinputformat.linespermap</name>
                    <value>1</value>
                </property>
                <property>
                    <name>mapreduce.map.speculative</name>
                    <value>false</value>
                </property>
                <property>
                    <name>mapreduce.job.outputformat.class</name>
                    <value>org.apache.hadoop.mapreduce.lib.output.TextOutputFormat</value>
                </property>
                <property>
                    <name>mapreduce.job.output.key.class</name>
                    <value>org.apache.hadoop.io.Text</value>
                </property>
                <property>
                    <name>mapreduce.job.output.value.class</name>
                    <value>org.apache.hadoop.io.Text</value>
                </property>
                <property>
                    <name>mapreduce.task.timeout</name>
                    <value>0</value>
                </property>
                <property>
                    <name>mapreduce.input.fileinputformat.inputdir</name>
                    <value>/sflow/lib/gentasks.properties</value>
                </property>
                <property>
                    <name>mapreduce.output.fileoutputformat.outputdir</name>
                    <value>/sflow/genTasks/${wf:id()}</value>
                </property>
                <property>
                    <name>cmdClassName</name>
                    <value>org.cldutil.stock.etl.cmd.GenCrawlTaskCmd</value>
                </property>
                <property>
                    <name>wfName</name>
                    <value>${wfName}</value>
                </property>
                <property>
                    <name>wfid</name>
                    <value>${wf:id()}</value>
                </property>
                <property>
                    <name>staticConfigFile</name>
                    <value>action.sftp.properties</value>
                </property>
            </configuration>
        </map-reduce>
		<ok to="crawlCmd"/>
		<error to="fail"/>
	</action>
	<action name="crawlCmd">
		<map-reduce>
			<job-tracker>${jobTracker}</job-tracker>
			<name-node>${nameNode}</name-node>
			<prepare>
				<delete path="/sflow/crawlCmd/${wf:id()}"/>
			</prepare>
			<configuration>
               <property>
                    <name>mapred.mapper.new-api</name>
                    <value>true</value>
                </property>
                <property>
                    <name>mapred.reducer.new-api</name>
                    <value>true</value>
                </property>
                <property>
                    <name>mapreduce.job.map.class</name>
                    <value>etl.engine.InvokeMapper</value>
                </property>
                <property>
                    <name>mapreduce.job.inputformat.class</name>
                    <value>org.apache.hadoop.mapreduce.lib.input.NLineInputFormat</value>
                </property>
                <property>
                    <name>mapreduce.input.lineinputformat.linespermap</name>
                    <value>1</value>
                </property>
                <property>
                    <name>mapreduce.map.speculative</name>
                    <value>false</value>
                </property>
                <property>
                    <name>mapreduce.job.outputformat.class</name>
                    <value>org.apache.hadoop.mapreduce.lib.output.TextOutputFormat</value>
                </property>
                <property>
                    <name>mapreduce.job.output.key.class</name>
                    <value>org.apache.hadoop.io.Text</value>
                </property>
                <property>
                    <name>mapreduce.job.output.value.class</name>
                    <value>org.apache.hadoop.io.Text</value>
                </property>
                <property>
                    <name>mapreduce.task.timeout</name>
                    <value>0</value>
                </property>
                <property>
                    <name>mapreduce.input.fileinputformat.inputdir</name>
                    <value>/sflow/genTasks/${wf:id()}</value>
                </property>
                <property>
                    <name>mapreduce.output.fileoutputformat.outputdir</name>
                    <value>/sflow/crawlCmd/${wf:id()}</value>
                </property>
                <property>
                    <name>cmdClassName</name>
                    <value>org.cldutil.taskmgr.bdapcmd.ExeCldTaskCmd</value>
                </property>
                <property>
                    <name>wfName</name>
                    <value>${wfName}</value>
                </property>
                <property>
                    <name>wfid</name>
                    <value>${wf:id()}</value>
                </property>
                <property>
                    <name>staticConfigFile</name>
                    <value>action.crawlCmd.properties</value>
                </property>
			</configuration>
		</map-reduce>
		<ok to="end"/>
		<error to="fail"/>
	</action>
	<end name="End"/>
</workflow-app>
